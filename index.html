<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Städte-Ratespiel Deutschland</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      font-size: 1.1em;
    }
    #map {
      width: 100%;
      height: 75vh;
    }
    #info {
      padding: 16px;
      background: #f8f8f8;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: flex-start;
    }
    #info > div {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    #cityName {
      font-size: 1.2em;
      font-weight: bold;
    }
    #score, #highscore, #timer, #round {
      font-weight: bold;
    }
    button, select {
      padding: 12px 16px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
    }
    button:hover {
      background: #0056b3;
    }
    @media (min-width: 600px) {
      #info {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }
  </style>

  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"
  />
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body>
  <div id="info">
    <div id="cityName">Klicke auf die Karte, um die Stadt oder Sehenswürdigkeit zu lokalisieren!</div>
    <div>
      <span id="round">Frage: 1 / 10</span>
      <span id="score">Punkte: 0</span>
      <span id="highscore">Highscore: 0</span>
      <span id="timer">Zeit: 15</span>
    </div>
    <div>
      <button onclick="nextRound()">Nächste Runde</button>
      <select id="styleSelector" onchange="changeMapStyle()">
        <option value="osm">Standard OSM (mit Labels)</option>
        <option value="toner">Stamen Toner Lite (kein Label)</option>
        <option value="carto">Carto Voyager No Labels</option>
      </select>
    </div>
  </div>

  <div id="map"></div>

  <script>
    const locations = [
      { name: "Aachen", lat: 50.7753, lon: 6.0839 },
      { name: "Bamberg", lat: 49.8917, lon: 10.8864 },
      { name: "Bayreuth", lat: 49.9481, lon: 11.5789 },
      { name: "Bielefeld", lat: 52.0302, lon: 8.5325 },
      { name: "Braunschweig", lat: 52.2689, lon: 10.5268 },
      { name: "Cottbus", lat: 51.7563, lon: 14.3329 },
      { name: "Darmstadt", lat: 49.8728, lon: 8.6512 },
      { name: "Erfurt", lat: 50.977, lon: 11.0299 },
      { name: "Flensburg", lat: 54.7939, lon: 9.4465 },
      { name: "Göttingen", lat: 51.5328, lon: 9.9352 },
      { name: "Heidelberg", lat: 49.3988, lon: 8.6724 },
      { name: "Jena", lat: 50.9271, lon: 11.5892 },
      { name: "Kaiserslautern", lat: 49.4401, lon: 7.7491 },
      { name: "Koblenz", lat: 50.3569, lon: 7.5889 },
      { name: "Lübeck", lat: 53.8655, lon: 10.6866 },
      { name: "Oldenburg", lat: 53.1435, lon: 8.2146 },
      { name: "Potsdam", lat: 52.3906, lon: 13.0645 },
      { name: "Regensburg", lat: 49.0134, lon: 12.1016 },
      { name: "Trier", lat: 49.7499, lon: 6.6371 },
      { name: "Wismar", lat: 53.8925, lon: 11.4658 },
      { name: "Brandenburger Tor", lat: 52.5163, lon: 13.3777 },
      { name: "Schloss Neuschwanstein", lat: 47.5576, lon: 10.7498 },
      { name: "Kölner Dom", lat: 50.9413, lon: 6.9583 },
      { name: "Marienplatz", lat: 48.1374, lon: 11.5755 },
      { name: "Reichstagsgebäude", lat: 52.5186, lon: 13.3762 },
      { name: "Heide Park", lat: 53.0167, lon: 9.8833 },
      { name: "Zugspitze", lat: 47.4211, lon: 10.984 },
      { name: "Miniatur Wunderland", lat: 53.5439, lon: 9.9883 },
      { name: "Tropical Islands", lat: 52.0375, lon: 13.7456 },
      { name: "Europa-Park", lat: 48.267, lon: 7.7217 },
      { name: "Berliner Fernsehturm", lat: 52.5208, lon: 13.4094 },
      { name: "Holstentor", lat: 53.8669, lon: 10.6866 },
      { name: "Rathaus Hamburg", lat: 53.5503, lon: 9.992 },
      { name: "Loreley-Fels", lat: 50.1097, lon: 7.7265 },
      { name: "Sanssouci", lat: 52.4031, lon: 13.0365 },
      { name: "Deutsches Museum", lat: 48.1303, lon: 11.584 },
      { name: "Schloss Charlottenburg", lat: 52.5205, lon: 13.2956 },
      { name: "Harz Nationalpark", lat: 51.799, lon: 10.6186 },
      { name: "Dachau Gedenkstätte", lat: 48.2706, lon: 11.4666 },
      { name: "Teutoburger Wald", lat: 51.9405, lon: 8.6228 }
    ];

    // Leaflet Tile Layers for map styles:
    const tileLayers = {
      osm: L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }),
      toner: L.tileLayer(
        "https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",
        {
          maxZoom: 20,
          attribution:
            'Map tiles by <a href="http://stamen.com">Stamen Design</a>, ' +
            'under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. ' +
            'Data by <a href="https://openstreetmap.org">OpenStreetMap</a>, under ODbL.',
        }
      ),
      carto: L.tileLayer(
        "https://cartodb-basemaps-a.global.ssl.fastly.net/rastertiles/voyager_nolabels/{z}/{x}/{y}.png",
        {
          maxZoom: 19,
          attribution:
            '&copy; <a href="https://carto.com/attributions">CARTO</a>, ' +
            '© OpenStreetMap contributors',
        }
      ),
    };

    let map = L.map("map", {
      center: [51.1657, 10.4515],
      zoom: 6,
      layers: [tileLayers.osm],
    });

    // Current tile layer reference for switching
    let currentLayer = tileLayers.osm;

    function changeMapStyle() {
      const style = document.getElementById("styleSelector").value;
      if (currentLayer) {
        map.removeLayer(currentLayer);
      }
      currentLayer = tileLayers[style];
      map.addLayer(currentLayer);
    }

    // === Spiel-Logik (vereinfacht) ===

    let currentQuestionIndex = 0;
    let score = 0;
    let highscore = 0;
    let timer = 15;
    let timerInterval;
    let guessMarker = null;
    let answerMarker = null;
    let line = null;

    const totalRounds = 10;

    function startGame() {
      score = 0;
      currentQuestionIndex = 0;
      document.getElementById("score").textContent = "Punkte: " + score;
      document.getElementById("round").textContent =
        "Frage: " + (currentQuestionIndex + 1) + " / " + totalRounds;
      nextRound();
    }

    function nextRound() {
      clearInterval(timerInterval);
      timer = 15;
      document.getElementById("timer").textContent = "Zeit: " + timer;
      document.getElementById("cityName").textContent =
        "Klicke auf die Karte, um die Stadt oder Sehenswürdigkeit zu lokalisieren!";
      if (guessMarker) {
        map.removeLayer(guessMarker);
        guessMarker = null;
      }
      if (answerMarker) {
        map.removeLayer(answerMarker);
        answerMarker = null;
      }
      if (line) {
        map.removeLayer(line);
        line = null;
      }
      if (currentQuestionIndex >= totalRounds) {
        alert(
          `Spiel beendet! Deine Punktzahl: ${score}\n` +
            `Highscore: ${highscore}`
        );
        if (score > highscore) {
          highscore = score;
          document.getElementById("highscore").textContent =
            "Highscore: " + highscore;
        }
        return;
      }
      // Setze die aktuelle Location
      currentLocation = locations[Math.floor(Math.random() * locations.length)];
      currentQuestionIndex++;
      document.getElementById("round").textContent =
        "Frage: " + currentQuestionIndex + " / " + totalRounds;
      document.getElementById("score").textContent = "Punkte: " + score;

      // Starte Timer
      timerInterval = setInterval(() => {
        timer--;
        document.getElementById("timer").textContent = "Zeit: " + timer;
        if (timer <= 0) {
          clearInterval(timerInterval);
          alert("Zeit abgelaufen! Nächste Runde.");
          nextRound();
        }
      }, 1000);
    }

    // Spieler klickt auf Karte:
    let currentLocation = null;

    map.on("click", function (e) {
      if (!currentLocation) return;

      clearInterval(timerInterval);

      if (guessMarker) {
        map.removeLayer(guessMarker);
      }
      guessMarker = L.marker(e.latlng, { title: "Dein Tipp" }).addTo(map);

      if (answerMarker) {
        map.removeLayer(answerMarker);
      }
      answerMarker = L.marker(
        [currentLocation.lat, currentLocation.lon],
        { title: currentLocation.name, icon: L.icon({
          iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
        }) }
      ).addTo(map);

      // Linie zur Antwort zeichnen mit kontrastreicher Farbe je nach Stil
      if (line) {
        map.removeLayer(line);
      }
      let lineColor = "#ff7800"; // Standard Orange
      if (currentLayer === tileLayers.toner) lineColor = "#00ff00"; // grelles Grün
      else if (currentLayer === tileLayers.carto) lineColor = "#ff0000"; // Rot

      line = L.polyline([e.latlng, [currentLocation.lat, currentLocation.lon]], {
        color: lineColor,
        weight: 4,
        opacity: 0.8,
      }).addTo(map);

      // Entfernung berechnen (Haversine)
      const dist = map.distance(e.latlng, L.latLng(currentLocation.lat, currentLocation.lon));

      // Punktevergabe (max 1000 Punkte, abnehmend mit Entfernung)
      const points = Math.max(0, Math.round(1000 - dist / 10));
      score += points;
      document.getElementById("score").textContent = "Punkte: " + score;

      document.getElementById("cityName").textContent =
        `Richtig: ${currentLocation.name} – Deine Entfernung: ${Math.round(dist)} m – Punkte: ${points}`;

      // Nach Antwort Button aktivieren
      document.querySelector("button").disabled = false;
    });

    // Zu Beginn Button deaktivieren bis Klick erfolgt
    document.querySelector("button").disabled = true;

    function changeMapStyle() {
      const style = document.getElementById("styleSelector").value;
      if (currentLayer) {
        map.removeLayer(currentLayer);
      }
      currentLayer = tileLayers[style];
      map.addLayer(currentLayer);

      // Linie nach Stilfarbe ggf. anpassen, falls aktiv:
      if (line) {
        let lineColor = "#ff7800"; // Default
        if (currentLayer === tileLayers.toner) lineColor = "#00ff00";
        else if (currentLayer === tileLayers.carto) lineColor = "#ff0000";
        line.setStyle({ color: lineColor });
      }
    }

    startGame();
  </script>
</body>
</html>
