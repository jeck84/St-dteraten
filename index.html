<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Städte-Ratespiel Deutschland</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif; font-size: 1.1em;
    }
    #map {
      width: 100%;
      height: 75vh;
    }
    #info {
      padding: 16px;
      background: #f8f8f8;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    #info > div {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }
    #cityName { font-size: 1.2em; font-weight: bold; }
    #score, #highscore, #timer, #round { font-weight: bold; }
    button, select {
      padding: 12px 16px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }
    button { background: #007bff; color: white; border: none; }
    button:hover { background: #0056b3; }
    @media (min-width: 600px) {
      #info { flex-direction: row; justify-content: space-between; }
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body>
  <div id="info">
    <div id="cityName">Klicke auf die Karte, um die Stadt oder Sehenswürdigkeit zu lokalisieren!</div>
    <div>
      <span id="round">Frage: 1 / 10</span>
      <span id="score">Punkte: 0</span>
      <span id="highscore">Highscore: 0</span>
    </div>
    <div>
      <button onclick="nextRound()">Nächste Runde</button>
      <select id="styleSelector" onchange="changeMapStyle()">
        <option value="dark">Dunkel</option>
        <option value="osm">Standard</option>
        <option value="gray">Grau</option>
        <option value="toner">Toner Lite</option>
      </select>
    </div>
  </div>
  <div id="map"></div>

  <script>
    const locations = [
      { name: "Aachen", lat: 50.7753, lon: 6.0839 },
      { name: "Bamberg", lat: 49.8917, lon: 10.8864 },
      { name: "Kölner Dom", lat: 50.9413, lon: 6.9583 },
      { name: "Schloss Neuschwanstein", lat: 47.5576, lon: 10.7498 },
      { name: "Brandenburger Tor", lat: 52.5163, lon: 13.3777 },
      { name: "Reichstagsgebäude", lat: 52.5186, lon: 13.3762 },
      { name: "Marienplatz", lat: 48.1374, lon: 11.5755 },
      { name: "Potsdam", lat: 52.3906, lon: 13.0645 },
      { name: "Heidelberg", lat: 49.3988, lon: 8.6724 },
      { name: "Trier", lat: 49.7499, lon: 6.6371 },
      { name: "Europa-Park", lat: 48.267, lon: 7.7217 },
      { name: "Zugspitze", lat: 47.4211, lon: 10.984 }
    ];

    const baseLayers = {
      dark: 'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png',
      osm: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      gray: 'https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png',
      toner: 'https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png'
    };

    let map = L.map('map').setView([51.1657, 10.4515], 6);
    let baseLayer = L.tileLayer(baseLayers.dark, {
      attribution: '&copy; OpenStreetMap contributors | Tiles: CartoDB/Stamen',
      maxZoom: 19
    }).addTo(map);

    let target = null;
    let score = 0;
    let round = 0;
    let highscore = 0;
    let guessMarker = null;
    let line = null;

    function nextRound() {
      if (guessMarker) map.removeLayer(guessMarker);
      if (line) map.removeLayer(line);

      if (round >= 10) {
        alert(`Spiel vorbei! Dein Punktestand: ${score}`);
        if (score > highscore) highscore = score;
        document.getElementById('highscore').innerText = `Highscore: ${highscore}`;
        score = 0;
        round = 0;
      }

      round++;
      document.getElementById('round').innerText = `Frage: ${round} / 10`;
      document.getElementById('score').innerText = `Punkte: ${score}`;
      target = locations[Math.floor(Math.random() * locations.length)];
      document.getElementById('cityName').innerText = `Wo liegt: ${target.name}?`;
    }

    map.on('click', function (e) {
      if (!target) return;

      const guessLatLng = e.latlng;
      const targetLatLng = L.latLng(target.lat, target.lon);
      const distance = map.distance(guessLatLng, targetLatLng) / 1000;
      const points = Math.max(0, Math.round(100 - distance));
      score += points;

      document.getElementById('score').innerText = `Punkte: ${score}`;
      alert(`${target.name} war ${distance.toFixed(1)} km entfernt. Punkte: ${points}`);

      guessMarker = L.marker(guessLatLng).addTo(map);
      line = L.polyline([guessLatLng, targetLatLng], {
        color: '#ff6600',
        weight: 3
      }).addTo(map);

      setTimeout(() => nextRound(), 1500);
      target = null;
    });

    function changeMapStyle() {
      const style = document.getElementById("styleSelector").value;
      if (map.hasLayer(baseLayer)) map.removeLayer(baseLayer);
      baseLayer = L.tileLayer(baseLayers[style], {
        attribution: '&copy; OpenStreetMap contributors | Tiles: CartoDB/Stamen',
        maxZoom: 19
      }).addTo(map);
    }

    nextRound();
  </script>
</body>
</html>
